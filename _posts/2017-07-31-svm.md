---
layout: default
---

## 支持向量机
在n维空间上定义一个超平面

$$\omega^T x + b = 0$$

### 定义：函数间隔

对于一个特征 F，通常使用空间中的一点来表示，如果已知其分类类型，那么这就成为一个训练数据，用一个二元组来表示为：$$ (x^{(i)}, y^{(i)}) $$，训练数据与超平面的函数间隔定义为

$$\hat{\gamma}^{(i)} = y^{(i)} ( \omega^T x^{(i)} + b)$$

将点 F 代入函数 $$\omega^T x + b$$ 中，实际上是在判断此点与上述超平面的位置关系。其正负号决定了该点位于超平面的哪一侧，而其绝对值则度量了该点与超平面的距离。
如果规定 $$\omega^T x^{(i)} + b > 0 $$ 时，$$ y^{(i)} = 1 $$，反之 $$ y^{(i)} = -1 $$。那么显然，$$\hat{\gamma}^{(i)}$$ 始终为正。于是 $$\hat{\gamma}^{(i)}$$ 就可以看作点 F 到超平面的相对距离。
若有一组特征及其分类结果组成的训练数据 $$S = \{(x^{(i)}, y^{(i)}) | i = 1,,,m\}$$ ，那么最小函数间隔就为

$$ \hat{\gamma} = \min\limits_{i = 1,,,m} \hat{\gamma}^{(i)} $$

### 定义：几何间隔

![](/resources/2017-07-31-svm/geo-margin.png)

可以证明，以 $$\omega$$ 为系数的超平面本身垂直于向量 $$\omega$$ 。假设点A的坐标为 $$x^{(i)}$$ ，到超平面的距离为 $$ \bar{\gamma}^{(i)} $$。那么过点A，作垂直于超平面的直线，交点为B，AB两点满足下面的关系

$$ x^{(i)} = x_B + \omega \bar{\gamma}^{(i)} $$

然后根据 $$ \omega^T x_B + b = 0 $$ ， 可得

$$ \bar{\gamma}^{(i)} = \frac{\omega^T}{||\omega||} x^{(i)} + \frac{b}{||\omega||} $$

同函数间隔类似，规定，当 $$\bar{\gamma}^{(i)} > 0$$ 时，$$y^{(i)} = 1$$ ，否则 $$y^{(i)} = -1$$。然后定义

$$\gamma^{(i)} = y^{(i)} \bar{\gamma}^{(i)} = y^{(i)} \left(\frac{\omega^T}{||\omega||} x^{(i)} + \frac{b}{||\omega||} \right)$$

显然，$$\gamma^{(i)} > 0$$ 恒成立。这里把 $$\gamma^{(i)}$$ 称为点A到超平面的几何间隔。值得注意的是，几何间隔实际就是点到超平面的距离。同样，对于一组训练数据集，定义最小几何间隔

$$\gamma = \min\limits_{i = 1,,,m} \gamma^{(i)}$$

### 最优间隔分类器

所谓分类器其实就是一个超平面，其作用是在空间中将两类数据分开，可以想象，这样的超平面如果存在，那么很可能不止一个。而我们想要的其实是满足下述条件的超平面：对于一组训练数据，使得最小几何间隔最大，即所谓的最优间隔分类器，如下图所示

![](/resources/2017-07-31-svm/max-margin.png)

也就是说，要求解下面的优化问题

$$
\begin{align*}
  \begin{array} {cc}
    \max\limits_{\omega, b}\quad \gamma \\ 
    s.t.  \qquad\!y^{(i)} \left(\frac{\omega^T}{||\omega||} x^{(i)} + \frac{b}{||\omega||}\right) >= \gamma \qquad i = 1,,,m
  \end{array}
\end{align*}
$$

考虑到函数间隔和几何间隔的定义，可以发现

$$\hat{\gamma}^{(i)} = ||\omega|| \gamma^{(i)}$$
 
于是，原问题可以重新表述为

$$
\begin{align*}
  \begin{array} {cc}
    \max\limits_{\omega, b}\quad \frac{\hat\gamma}{||\omega||} \\ 
    s.t.  \qquad\!y^{(i)} \left(\frac{\omega^T}{||\omega||} x^{(i)} + \frac{b}{||\omega||}\right) >= \hat\gamma \qquad i = 1,,,m
  \end{array}
\end{align*}
$$

这就将原本由几何间隔表达的问题，转换成了用函数间隔来表达。
这样做的原因在于：几何间隔是点到超平面的绝对距离，而函数间隔是相对距离，可以通过缩放 $$\omega, b$$ 这两个参数来调整。显然这一缩放操作，并不会影响超平面的位置。所以我们可以通过缩放将 $$\hat\gamma$$ 设置为1，而不改变整个系统本质。
所以对 $$\frac{\hat{\gamma}^{(i)}}{||\omega||}$$ 的最大化，就是最大化 $$\frac{1}{||\omega||}$$，也等价于最小化 $$\frac 1 2 \omega^2$$。所以原问题又转换为

$$
\begin{align*}
  \begin{array} {cc}
    \max\limits_{\omega, b}\quad \frac 1 2 \omega^2 \\ 
    s.t.  \qquad\!y^{(i)} \left(\frac{\omega^T}{||\omega||} x^{(i)} + \frac{b}{||\omega||}\right) >= 1 \qquad i = 1,,,m
  \end{array}
\end{align*}
$$

### 拉格朗日对偶问题

考虑同时带有等式约束和不等式约束的优化问题（这里称之为原问题）

$$
\begin{align*}
  \begin{array} {cc}
    \min\limits_{\omega}\quad f(\omega) \\ 
    s.t. \qquad g_i(\omega) <= 0 \quad i = 1,,,m\\
	\qquad h_i(\omega) = 0 \quad i = 1,,,k
	
  \end{array}
\end{align*}
$$

建立拉格朗日函数

$$L(\omega, \alpha, \beta) = f(\omega) + \sum_{i=1}^m \alpha_i g_i(\omega) + \sum_{i=1}^k \beta_i h_i(\omega)$$ 

进而考虑下述优化问题

$$\Theta_P(\omega) = \max\limits_{\alpha, \beta} L(\omega, \alpha, \beta) \quad \alpha_i > 0$$

如果存在 $$g_i(\omega) > 0$$ 或者 $$h_i(\omega) \neq 0$$，那么我们可以找到适当 $$\alpha, \beta$$ 的使得 $$\Theta_P(\omega) = \infty$$。反之，如果 $$\omega$$ 满足原问题的所有约束条件，那么 $$L(\omega, \alpha, \beta)$$ 的最大值就等于 $$f(\omega)$$。
于是有

$$
\begin{equation}
  \Theta_P(\omega) = \left\{
    \begin{aligned}
	  f(\omega) \quad if \quad h_i(\omega) = 0 \quad and g_i(\omega) >= 0 \quad for \quad all \quad i\\ 
	  \infty \qquad otherwise
	\end{aligned}
    
  \right.
\end{equation}
$$

从而原问题可以表述为


$$\min\limits_\omega \Theta_P(\omega) = \min\limits_\omega \max\limits_{\alpha, \beta} L(\omega, \alpha, \beta)$$


假设 $$p^* = \min\limits_\omega \Theta_P(\omega)$$ 为原问题的解。另一方面，定义原问题的对偶问题

$$
d^* = \max\limits_{\alpha, \beta} \min\limits_\omega L(\omega, \alpha, \beta)
$$

可以证明 $$d^* <= p^*$$ 恒成立。并且在满足特定情况的条件下
$$d^* = p^*$$

假设 $$f, g_i(\omega)$$ 是凸函数，$$h_i(\omega)$$ 可以表示成 $$h_i(\omega) = a_i \omega + b$$，且存在 $$\omega$$ 使得 $$g_i(\omega) < 0$$。
在这种假设下，必然存在 $$\omega^*$$ 是原问题的解，$$\alpha^*, \beta^*$$ 是对偶问题的解，并且 $$d^* = p^* = L(\omega^*, \alpha^*, \beta^*)$$，
而且 $$\omega^*, \alpha^*, \beta^*$$ 还应满足KKT条件，即

$$
\begin{align*}
  \begin{array} {cc}
    \frac{\partial L^*}{\partial \omega_i} = 0, i = 1,,,n \quad(1)\\
	\frac{\partial L^*}{\partial \beta_i} = 0, i = 1,,,n \quad (2)\\
	\alpha_i^* g_i(\omega) = 0 ,i = 1,,,m \quad (3)\\
	g_i(\omega) <= 0, i = 1,,,m \quad (4) \\ 
	\alpha_i >= 0, i=1,,,m \quad (5)
	
  \end{array}
\end{align*}
$$

特别注意第(3)个条件，如果 $$\alpha_i^* > 0$$，那么 $$g_i(\omega) = 0$$。

### 最优间隔分类器

现在回到最优间隔分类器的讨论，之前已经提出了下述的等价优化问题

$$
\begin{align*}
  \begin{array} {cc}
    \min\limits_{\omega}\quad f(\omega) \\ 
    s.t. \qquad g_i(\omega) <= 0 \quad i = 1,,,m\\
	\qquad h_i(\omega) = 0 \quad i = 1,,,k
	
  \end{array}
\end{align*}
$$

若设 $$ g_i(\omega) = -y^{(i)} (\omega^T x^{(i)} + b) + 1$$，那么约束条件可以表述为 $$g_i(\omega) <= 0 \quad i = 1,,,m$$

![](/resources/2017-07-31-svm/max-margin2.png)
